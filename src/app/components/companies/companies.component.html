<main id="main" class="main">
    <section class="section dashboard">
        <div class="row">
            <div class="col-lg-12">
                <table class="table table-striped table-hover company_detail_table input_back_none mb-4" id="companyTable">
                    <thead>
                        <tr>
                            <th scope="col">Company Name</th>
                            <th scope="col">Email ID / Website</th>
                            <th scope="col">Contact No.</th>
                            <th scope="col">Type</th>
                            <th scope="col">Address</th>
                            <th scope="col">No of Employees</th>
                            <th scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="input_back_none" *ngFor="let company of companies">
                            <td>
                                <input type="text" [(ngModel)]="company.company_name"  [class.input_edit]="editingStates[company._id]">
                                <input type="hidden" name="companyId" [value]="company._id">
                            </td>
                            <td class="tr">
                                <div>
                                    <input type="email" [(ngModel)]="company.company_email"  [class.input_edit]="editingStates[company._id]" [class]="{'require': !company.company_email}" [readonly]="!editingStates[company._id]" [disabled]="!editingStates[company._id]">
                                </div>
                                <div>
                                    <a [href]="company.company_website" target="_blank" id="visitWebsiteLink">
                                        <label>{{company.company_website}}</label>
                                    </a>
                                    <textarea id="companyUrl" class="company_url " [(ngModel)]="company.company_website" [readonly]="!editingStates[company._id]" [disabled]="!editingStates[company._id]" [class.input_edit]="editingStates[company._id]" style="display: inline;" [class.input_edit]="editingStates[company._id]"></textarea>
                                </div>
                            </td>
                            <td>
                                <input type="text" pattern="[0-9]{10}" title="10-digit phone number" [(ngModel)]="company.company_contact" #companyContactInput [readonly]="!editingStates[company._id]" [disabled]="!editingStates[company._id]" [class.input_edit]="editingStates[company._id]" name="companyContact">
                            </td>
                            <td>
                                <input type="text" name="companyType" [(ngModel)]="company.company_type"  [readonly]="!editingStates[company._id]" [disabled]="!editingStates[company._id]" [class.input_edit]="editingStates[company._id]">
                            </td>
                            <td>
                                <input type="text" name="companyAddress" [(ngModel)]="company.company_address"  [readonly]="!editingStates[company._id]" [disabled]="!editingStates[company._id]" [class.input_edit]="editingStates[company._id]">
                            </td>
                            <td>
                                <input type="text" name="companySize" class="require" [(ngModel)]="company.company_size"  [readonly]="!editingStates[company._id]" [disabled]="!editingStates[company._id]" [class.input_edit]="editingStates[company._id]" [class]="{'require': !company.company_size}">
                            </td>
                            <td class="show_hide">
                                <a class="edit_table ed" (click)="toggleEditState(company._id)">
                                    <i [class]="editingStates[company._id] ? 'bi bi-save-fill' : 'bx bxs-edit'"></i>
                                </a>
                                <a class="show"><i class="bx bx-show" (click)="seeMore(company._id)" ></i></a>
                            </td>
                        </tr>
                    </tbody>
                </table>
                


                <!-- parent.component.html -->
                <app-pagination [currentPage]="currentPage" [totalPages]="totalPages"
                    (pageChanged)="onPageChange($event)"></app-pagination>




                <!-- <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">

                        <li class="page-item disabled">
                            <span class="page-link">Previous</span>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="
                                    
                                        /admin/company/companies_list?page=1
                                    ">1
                            </a>
                        </li>
                        <li class="page-item"><a class="page-link" href="
                                    /admin/company/companies_list?page=2
                                " aria-label="Next">2</a></li>

                        <li class="page-item">
                            <a class="page-link" href="
                                
                                    /admin/company/companies_list?page=2
                                " aria-label="Next">
                                Next
                            </a>
                        </li>
                    </ul>
                </nav> -->

            </div>
        </div>
    </section>
</main>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<script>

    document.addEventListener("DOMContentLoaded", function () {


        // Add click event listeners
        document.querySelectorAll('.edit_table').forEach(editButton => {

            editButton.addEventListener('click', function (event) {


                event.preventDefault();
                const row = this.closest('tr'); // Find the parent row

                //console.log(row); // Check the row variable

                const saveButton = row.querySelector('#saveComp');
                //console.log(saveButton); // Check if saveButton is correctly selected

                const showButton = row.querySelector('.show');
                const hideButton = row.querySelector('.hide');

                // Hide edit button and show save button
                editButton.classList.add('dn');
                saveButton.classList.remove('dn');

                const labelElement = row.querySelector('#companyUrlLabel');
                const Element = row.querySelector('#companyUrl');

                // Hide the label element
                if (labelElement) {
                    labelElement.style.display = 'none';
                }
                if (Element) {
                    Element.style.display = 'inline'; // or 'block' if default display is block
                }
                const companyNameInput = row.querySelector('#companyName');
                const companyUrlInput = row.querySelector('#companyUrl');
                const companyEmailInput = row.querySelector('#companyEmail');
                const companyContactInput = row.querySelector('#companyContact');
                const companyTypeInput = row.querySelector('#companyType');
                const companyAddressInput = row.querySelector('#companyAddress');
                const companySizeInput = row.querySelector('#companySize');



                // Enable input fields for editing
                companyNameInput.removeAttribute('readonly');
                companyEmailInput.removeAttribute('readonly');
                companyUrlInput.removeAttribute('readonly');
                companyContactInput.removeAttribute('readonly');
                companyTypeInput.removeAttribute('readonly');
                companyAddressInput.removeAttribute('readonly');
                companySizeInput.removeAttribute('readonly');

                companyNameInput.removeAttribute('disabled');
                companyEmailInput.removeAttribute('disabled');
                companyUrlInput.removeAttribute('disabled');
                companyContactInput.removeAttribute('disabled');
                companyTypeInput.removeAttribute('disabled');
                companyAddressInput.removeAttribute('disabled');
                companySizeInput.removeAttribute('disabled');

                companyNameInput.classList.add('input_edit');
                companyEmailInput.classList.add('input_edit');
                companyUrlInput.classList.add('input_edit');
                companyContactInput.classList.add('input_edit');
                companyTypeInput.classList.add('input_edit');
                companyAddressInput.classList.add('input_edit');
                companySizeInput.classList.add('input_edit');



            });
        });
        document.querySelectorAll('#saveComp').forEach(saveButton => {

            saveButton.addEventListener('click', function (event) {
                event.preventDefault();

                const row = this.closest('tr'); // Find the parent row
                const showButton = row.querySelector('.show');
                const hideButton = row.querySelector('.hide');

                //console.log(saveButton); // Check if saveButton is correctly selected

                const companyIdInput = row.querySelector('#companyId');
                const companyNameInput = row.querySelector('#companyName');
                const companyUrlInput = row.querySelector('#companyUrl');
                const companyEmailInput = row.querySelector('#companyEmail');
                const companyContactInput = row.querySelector('#companyContact');
                const companyTypeInput = row.querySelector('#companyType');
                const companyAddressInput = row.querySelector('#companyAddress');
                const companySizeInput = row.querySelector('#companySize');

                // Gather data from input fields
                const dataToSend = {
                    companyId: companyIdInput.value,
                    companyName: companyNameInput.value,
                    companyUrl: companyUrlInput.value,
                    companyEmail: companyEmailInput.value,
                    companyContact: companyContactInput.value,
                    companyType: companyTypeInput.value,
                    companyAddress: companyAddressInput.value,
                    companySize: companySizeInput.value
                };

                // Perform AJAX request to send data to the backend
                const xhr = new XMLHttpRequest();
                xhr.open('POST', '/admin/company/update_company_detail_ajax');
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onload = function () {

                    if (xhr.status === 200) {



                        console.log('Data successfully sent to the backend.');

                        // Hide save button and show edit button after successful save
                        saveButton.classList.add('dn');
                        row.querySelector('.edit_table').classList.remove('dn');

                        companyUrlInput.setAttribute('readonly', true);

                        companyUrlInput.setAttribute('disabled', true);

                        companyUrlInput.classList.remove('input_edit');

                        // Disable input fields after saving
                        row.querySelectorAll('input').forEach(input => {
                            input.setAttribute('readonly', true);
                            input.setAttribute('disabled', true);
                            input.classList.remove('input_edit');
                        });
                    } else {
                        console.error('Failed to send data to the backend.');
                        // Handle error scenario
                    }
                };
                xhr.send(JSON.stringify(dataToSend));
            });
        });
    });

</script>
<script>


    var visitWebsiteLink = document.getElementById('visitWebsiteLink');
    // Prevent anchor link from being triggered
    visitWebsiteLink.addEventListener('click', function (event) {
        event.preventDefault();
        companyUrlInput.removeAttribute('readonly');
        companyUrlInput.focus(); //
    });

</script>
<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
        class="bi bi-arrow-up-short"></i></a>
<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/static/vendor/apexcharts/apexcharts.min.js"></script>
<script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/static/vendor/chart.js/chart.umd.js"></script>
<script src="/static/vendor/echarts/echarts.min.js"></script>
<script src="/static/vendor/quill/quill.min.js"></script>
<script src="/static/vendor/simple-datatables/simple-datatables.js"></script>
<script src="/static/vendor/tinymce/tinymce.min.js"></script>
<script src="/static/vendor/php-email-form/validate.js"></script>
<script src="/static/js/main.js"></script> -->